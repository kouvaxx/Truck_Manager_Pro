{% extends "layout.html" %}

{% block content %}
<h2 class="mb-4">Ordens de Serviço</h2>

<div class="card mb-4">
    <div class="card-header">Nova Ordem de Serviço</div>
    <div class="card-body">
        <form action="/os/create" method="post" class="row g-3 align-items-center">
            <div class="col-auto">
                <label for="client_id" class="col-form-label">Selecione o Cliente:</label>
            </div>
            <div class="col-auto">
                <select name="client_id" id="client_id" class="form-select" required>
                    <option value="" selected disabled>Escolha um cliente...</option>
                    {% for client in clients %}
                    <option value="{{ client.id }}">{{ client.name }} - {{ client.car_model }} ({{ client.car_plate }})
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-success">Abrir Nova OS</button>
            </div>
        </form>
    </div>
</div>

<table class="table table-striped table-hover">
    <thead class="table-dark">
        <tr>
            <th>OS #</th>
            <th>Cliente</th>
            <th>Veículo</th>
            <th>Status</th>
            <th>Data</th>
            <th>Total</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for os_data in os_list %}
        <tr>
            <td>{{ os_data.os.id }}</td>
            <td>{{ os_data.client.name }}</td>
            <td>{{ os_data.client.car_model }}</td>
            <td>
                {% if os_data.os.status == "Open" %}
                <span class="badge bg-primary">Aberta</span>
                {% elif os_data.os.status == "Closed" %}
                <span class="badge bg-success">Fechada</span>
                {% else %}
                <span class="badge bg-warning">Pendente</span>
                {% endif %}
            </td>
            <td>{{ os_data.os.created_at.strftime('%d/%m/%Y') }}</td>
            <td>R$ {{ "%.2f"|format(os_data.os.total_value) }}</td>
            <td>
                <a href="/os/{{ os_data.os.id }}" class="btn btn-info btn-sm">Ver Detalhes</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}